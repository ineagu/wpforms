var WPForms=window.WPForms||{};WPForms.Admin=WPForms.Admin||{},WPForms.Admin.Builder=WPForms.Admin.Builder||{},WPForms.Admin.Builder.Providers=WPForms.Admin.Builder.Providers||function(e,r,n){"use strict";var t={previews:new Map,cache:{},config:{templates:["wpforms-providers-builder-content-connection-fields","wpforms-providers-builder-content-connection-conditionals"]}},o={provider:"",providerHolder:{},form:n("#wpforms-builder-form"),spinner:'<i class="fa fa-circle-o-notch fa-spin wpforms-button-icon" />',ajax:{_mergeData:function(e){var r={id:n("#wpforms-builder-form").data("id"),nonce:wpforms_builder.nonce,action:"wpforms_builder_provider_ajax_"+o.provider};return n.extend(r,e),r},request:function(e,r){void 0!==e&&o.setProvider(e),r.data=o.ajax._mergeData(r.data||{});var i={url:wpforms_builder.ajax_url,type:"post",dataType:"json",beforeSend:function(){o.getProviderHolder().find(".wpforms-builder-provider-title-spinner").show()}};return n.extend(i,r),n.ajax(i).fail(function(e,r){console.error("provider:",o.provider),console.error(e),console.error(r)}).always(function(){o.getProviderHolder().find(".wpforms-builder-provider-title-spinner").hide()})}},cache:{provider:"",as:function(e){return this.provider=e,this},get:function(e){return void 0===t.cache[this.provider]||!t.cache[this.provider]instanceof Map?null:t.cache[this.provider].get(e)},getById:function(e,r){return void 0===this.get(e)[r]?null:this.get(e)[r]},set:function(e,r){return(void 0===t.cache[this.provider]||!t.cache[this.provider]instanceof Map)&&(t.cache[this.provider]=new Map),t.cache[this.provider].set(e,r)},addTo:function(e,r,i){(void 0===t.cache[this.provider]||!t.cache[this.provider]instanceof Map)&&(t.cache[this.provider]=new Map,this.set(e,{}));var o=this.get(e);return o[r]=i,this.set(e,o)},delete:function(e){return void 0===t.cache[this.provider]||!t.cache[this.provider]instanceof Map?null:t.cache[this.provider].delete(e)},deleteFrom:function(e,r){if(void 0===t.cache[this.provider]||!t.cache[this.provider]instanceof Map)return null;var i=this.get(e);return delete i[r],this.set(e,i)},clear:function(){void 0===t.cache[this.provider]||!t.cache[this.provider]instanceof Map||t.cache[this.provider].clear()}},init:function(){n(e).ready(o.ready)},ready:function(){o.providerHolder=n(".wpforms-builder-provider"),o.addTemplates(t.config.templates),o.bindActions(),o.ui.bindActions(),n("#wpforms-panel-providers").trigger("WPForms.Admin.Builder.Providers.ready")},bindActions:function(){n(e).on("wpformsSaved",function(){var e=n("#wpforms-panel-providers").find(".wpforms-builder-provider-connection");if(e.length){var o=!1;e.each(function(){var r=!1;if(n(this).find("input.wpforms-required, select.wpforms-required, textarea.wpforms-required").each(function(){var e=n(this).val();_.isEmpty(e)?(n(this).addClass("wpforms-error"),r=!0):n(this).removeClass("wpforms-error")}),r&&!o){var e=n(this).closest(".wpforms-builder-provider").find(".wpforms-builder-provider-title").clone();e.find("button").remove();var i=wpforms_builder.provider_required_flds;n.alert({title:wpforms_builder.heads_up,content:i.replace("{provider}","<strong>"+e.text().trim()+"</strong>"),icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:wpforms_builder.ok,btnClass:"btn-confirm",keys:["enter"]}}}),o=!0}})}}),n("#wpforms-panel-providers").on("connectionRendered",function(){!0===wpf.initialSave&&(wpf.savedState=wpf.getFormState("#wpforms-builder-form"))})},ui:{bindActions:function(){o.providerHolder.on("click",".js-wpforms-builder-provider-connection-add",function(e){e.preventDefault(),o.ui.connectionAdd()}).on("click",".js-wpforms-builder-provider-connection-delete",function(e){e.preventDefault(),o.ui.connectionDelete(n(this).closest(".wpforms-builder-provider-connection"))}),o.providerHolder.on("click",".js-wpforms-builder-provider-connection-fields-add",function(e){e.preventDefault();var r=n(this).parents(".wpforms-builder-provider-connection-fields-table"),i=r.find("tr").last().clone(!0),o=parseInt(/\[(\d+)\]/g.exec(i.find("input").attr("name"))[1],10)+1;i.find("input").attr("name",i.find("input").attr("name").replace(/\[fields_meta\]\[(\d+)\]/g,"[fields_meta]["+o+"]")).val(""),i.find("select").attr("name",i.find("select").attr("name").replace(/\[fields_meta\]\[(\d+)\]/g,"[fields_meta]["+o+"]")).val(""),i.find(".js-wpforms-builder-provider-connection-fields-delete").removeClass("hidden"),r.find("tbody").append(i.get(0))}).on("click",".js-wpforms-builder-provider-connection-fields-delete",function(e){e.preventDefault(),n(this).parents(".wpforms-builder-provider-connection-fields-table tr").remove()})},connectionAdd:function(){n.confirm({title:!1,content:wpforms_builder_providers.prompt_connection.replace(/%type%/g,"connection")+'<input autofocus="" type="text" id="wpforms-builder-provider-connection-name" placeholder="'+wpforms_builder_providers.prompt_placeholder+'"><p class="error">'+wpforms_builder_providers.error_name+"</p>",backgroundDismiss:!1,closeIcon:!1,icon:"fa fa-info-circle",type:"blue",buttons:{confirm:{text:wpforms_builder.ok,btnClass:"btn-confirm",keys:["enter"],action:function(){var e=this.$content.find("#wpforms-builder-provider-connection-name").val(),r=this.$content.find(".error");if(""===e)return r.show(),!1;o.providerHolder.trigger("connectionCreate",[e])}},cancel:{text:wpforms_builder.cancel}}})},connectionDelete:function(e){n.confirm({title:!1,content:wpforms_builder_providers.confirm_connection,icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:wpforms_builder.ok,btnClass:"btn-confirm",keys:["enter"],action:function(){o.providerHolder.trigger("connectionDelete",[e]),e.fadeOut("fast",function(){n(this).remove(),o.providerHolder.trigger("connectionDeleted",[e])})}},cancel:{text:wpforms_builder.cancel}}})}},setProvider:function(e){o.provider=e},getProviderHolder:function(){return n("#"+o.provider+"-provider")},addTemplates:function(e){e.forEach(function(e){t.previews.set(e,wp.template(e))})},getTemplate:function(e){var r=t.previews.get(e);return void 0!==r?r:function(){return""}}};return o}(document,window,jQuery),WPForms.Admin.Builder.Providers.init();